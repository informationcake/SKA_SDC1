Bootstrap: docker
From: ubuntu:18.04

%help
   Singularity image containing all required software to run SKA Science Data Challenge 1 solution (from Alex Clarke).

%environment
    
%post
    # Install common dependencies
    export DEBIAN_FRONTEND=noninteractive
    apt-get update \
      && apt-get --yes install --no-install-recommends \
      bison \
      build-essential \
      cmake \
      eog \
      flex \
      g++ \
      gcc \
      gettext-base \
      gfortran \
      git \
      libarmadillo-dev \
      libblas-dev \
      libcfitsio-dev \
      libfftw3-dev \
      libgsl-dev \
      libgtkmm-3.0-dev \
      libhdf5-serial-dev \
      liblapacke-dev \
      liblog4cplus-1.1-9 \
      liblog4cplus-dev \
      libncurses5-dev \
      libpng-dev \
      libpython2.7-dev \
      libreadline-dev \
      libxml2-dev \
      libboost-python-dev \
      libboost-numpy-dev \
      openssh-server \
      python3 \
      python3-pip \
      python3-tk \
      python3-setuptools \
      subversion \
      vim \
      wcslib-dev \
      wget \
      && rm -rf /var/lib/apt/lists/*

    # Install python3 packages
    pip3 install setuptools Cython
    pip3 install --upgrade \
      wheel \
      aplpy \
      astropy \
      numpy \
      matplotlib \
      scipy \
      wcsaxes \
      scikit-learn \
      umap-learn \
      datashader
      
    
    # 
    mkdir /opt/soft/
    
    # Install boost python 1.63 with python 3
    cd / \
    && wget https://dl.bintray.com/boostorg/release/1.63.0/source/boost_1_63_0.tar.bz2 \
    && tar xvf boost_1_63_0.tar.bz2 \
    && cd boost_1_63_0 \
    && ./bootstrap.sh \
           --with-python-version=3 \
           --with-libraries=python3,date_time,filesystem,system,program_options,test \
    && ./b2 install \
    && cd / && rm -r boost_1_63_0*
    
    # Install pyBDSF
    wget https://github.com/lofar-astron/PyBDSF/archive/v1.9.2.tar.gz \
    && tar xvf v1.9.2.tar.gz && cd PyBDSF-1.9.2 \
    && python3 setup.py install \
    && cd / && rm -rf v1.9.2.tar.gz PyBDSF-1.9.2
    
    
